---
title: MACI Command-line interface (CLI)
description: Introduction to the MACI CLI interface that allows for effective deployment and testing
sidebar_label: Command-line interface
sidebar_position: 5
---

# Command-line interface

MACI provides a command-line interface that allows for effective deployment and
testing. Applications that build on top of MACI, such as
[clr.fund](https://clr.fund/), implement their own web UIs.

Note that all the example commands default to a local Ethereum testnet at
`http://localhost:8545`, and use the Ethereum private key
`0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3`. Do not
send any real funds to the address generated by this key.

For testing purposes, you can run:

```bash
# in maci/contracts
npm run hardhat
```

## Subcommands

| Command | Description | Options |
|---------|-------------|---------|
| `create` | Deploy the contracts | `-v, --vkRegistryAddress <vkRegistryAddress>`: The vk registry contract address <br> `-i, --initialVoiceCredits <initialVoiceCredits>`: The initial voice credits <br> `-p, --initialVoiceCreditsProxyAddress <initialVoiceCreditsProxyAddress>`: The initial voice credits proxy contract address <br> `-g, --signupGatekeeperAddress <signupGatekeeperAddress>`: The signup gatekeeper contract address <br> `-q, --quiet`: Whether to print values to the console <br> `-s, --stateTreeDepth <stateTreeDepth>`: The state tree depth |
| `checkVerifyingKeys` | Check that the verifying keys in the contract match the local ones | `-q, --quiet`: Whether to print values to the console <br> `-x, --maci-contract <maciContract>`: The MACI contract address <br> `-s, --state-tree-depth <stateTreeDepth>`: The state tree depth <br> `-i, --int-state-tree-depth <intStateTreeDepth>`: The intermediate state tree depth <br> `-m, --msg-tree-depth <messageTreeDepth>`: The message tree depth <br> `-v, --vote-option-tree-depth <voteOptionTreeDepth>`: The vote option tree depth <br> `-b, --msg-batch-depth <messageBatchDepth>`: The message batch depth <br> `-p, --process-messages-zkey <processMessagesZkeyPath>`: The process messages zkey path <br> `-t, --tally-votes-zkey <tallyVotesZkeyPath>`: The tally votes zkey path |
| `genMaciPubKey` | Generate a new MACI public key | `-sk, --privkey <privkey>`: The private key |
| `genMaciKeyPair` | Generate a new MACI key pair | No options |
| `airdrop` | Airdrop topup credits to the coordinator | `-a, --amount <amount>`: The amount of topup <br> `-x, --contract <contract>`: The MACI contract address <br> `-o, --poll-id <pollId>`: Poll id <br> `-t, --token-address <tokenAddress>`: The token address <br> `-q, --quiet`: Whether to print values to the console |
| `deployVkRegistry` | Deploy a new verification key registry contract | `-q, --quiet`: Whether to print values to the console |
| `show` | Show the deployed contract addresses | No options |
| `deployPoll` | Deploy a new poll | `-t, --duration <pollDuration>`: The poll duration <br> `-g, --max-messages <maxMessages>`: The max messages <br> `-mv, --max-vote-options <maxVoteOptions>`: The max vote options <br> `-i, --int-state-tree-depth <intStateTreeDepth>`: The int state tree depth <br> `-b, --msg-batch-depth <messageTreeSubDepth>`: The message tree sub depth <br> `-m, --msg-tree-depth <messageTreeDepth>`: The message tree depth <br> `-v, --vote-option-tree-depth <voteOptionTreeDepth>`: The vote option tree depth <br> `-pk, --pubkey <coordinatorPubkey>`: The coordinator public key <br> `-x, --maci-address <maciAddress>`: The MACI contract address <br> `-q, --quiet`: Whether to print values to the console |
| `setVerifyingKeys` | Set the verifying keys | `-s, --state-tree-depth <stateTreeDepth>`: The state tree depth <br> `-i, --int-state-tree-depth <intStateTreeDepth>`: The intermediate state tree depth <br> `-m, --msg-tree-depth <messageTreeDepth>`: The message tree depth <br> `-v, --vote-option-tree-depth <voteOptionTreeDepth>`: The vote option tree depth <br> `-b, --msg-batch-depth <messageBatchDepth>`: The message batch depth <br> `-p, --process-messages-zkey <processMessagesZkeyPath>`: The process messages zkey path <br> `-t, --tally-votes-zkey <tallyVotesZkeyPath>`: The tally votes zkey path <br> `-k, --vk-registry <vkRegistry>`: The vk registry contract address <br> `-q, --quiet`: Whether to print values to the console <br> `-ss, --subsidy-zkey <subsidyZkeyPath>`: The subsidy zkey path |
| `publish` | Publish a new message to a MACI Poll contract | `-p, --pubkey <pubkey>`: The MACI public key which should replace the user's public key in the state tree <br> `-x, --contract <contract>`: The MACI contract address <br> `-sk, --privkey <privkey>`: Your serialized MACI private key <br> `-i, --state-index <stateIndex>`: The user's state index <br> `-v, --vote-option-index <voteOptionIndex>`: The vote option index <br> `-n, --nonce <nonce>`: The message nonce <br> `-s, --salt <salt>`: The message salt <br> `-o, --poll-id <pollId>`: The poll id <br> `-w, --new-vote-weight <newVoteWeight>`: The new vote weight <br> `-q, --quiet`: Whether to print values to the console |
| mergeMessages | Merge the message accumulator queue | `-q, --quiet`: Whether to print values to the console <br> `-x, --maci-contract-address <maciContractAddress>`: The MACI contract address <br> `-o, --poll-id <pollId>`: The poll id <br> `-n, --num-queue-ops <numQueueOps>`: The number of queue operations |
| mergeSignups | Merge the signups accumulator queue | `-q, --quiet`: Whether to print values to the console <br> `-x, --maci-contract-address <maciContractAddress>`: The MACI contract address <br> `-o, --poll-id <pollId>`: The poll id <br> `-n, --num-queue-ops <numQueueOps>`: The number of queue operations |
| timeTravel | Fast-forward the time (only works for local hardhat testing) | `-s, --seconds <seconds>`: The number of seconds to fast-forward <br> `-q, --quiet`: Whether to print values to the console |
| signup | Sign up to a MACI contract | `-p, --pubkey <maciPubKey>`: The MACI public key <br> `-x, --maci-address <maciAddress>`: The MACI contract address <br> `-s, --sg-data <sgData>`: The signup gateway data <br> `-i, --ivcp-data <ivcpData>`: The initial voice credit proxy data <br> `-q, --quiet`: Whether to print values to the console |
| topup | Top up an account with voice credits | `-a, --amount <amount>`: The amount of topup <br> `-x, --maci-address <maciAddress>`: The MACI contract address <br> `-i, --state-index <stateIndex>`: State leaf index <br> `-o, --poll-id <pollId>`: Poll id <br> `-q, --quiet`: Whether to print values to the console |
| fundWallet | Fund a wallet with Ether | `-a, --amount <amount>`: The amount of Ether <br> `-w, --address <address>`: The address to fund <br> `-q, --quiet`: Whether to print values to the console |
| verify | Verify the results of a poll and optionally the subsidy results | `-o, --poll-id <pollId>`: The poll id <br> `-t, --tally-file <tallyFile>`: The tally file <br> `-s, --subsidy-file <subsidyFile>`: The subsidy file <br> `-x, --contract <contract>`: The MACI contract address <br> `-tc, --tally-contract <tallyContract>`: The tally contract address <br> `-sc, --subsidy-contract <subsidyContract>`: The subsidy contract address <br> `-q, --quiet`: Whether to print values to the console |
| genProofs | Generate the proofs for a poll | `-sk, --privkey <privkey>`: Your serialized MACI private key <br> `-x, --contract <contract>`: The MACI contract address <br> `-o, --poll-id <pollId>`: The poll id <br> `-t, --tally-file <tallyFile>`: The tally file <br> `-s, --subsidy-file <subsidyFile>`: The subsidy file <br> `-r, --rapidsnark <rapidsnark>`: The path to the rapidsnark binary <br> `-wp, --process-witnessgen <processWitnessgen>`: The path to the process witness generation binary <br> `-wt, --tally-witnessgen <tallyWitnessgen>`: The path to the tally witness generation binary <br> `-ws, --subsidy-witnessgen <subsidyWitnessgen>`: The path to the subsidy witness generation binary <br> `-zp, --process-zkey <processZkey`: The path to the process zkey <br> `-zt, --tally-zkey <tallyZkey>`: The path to the tally zkey <br> `-zs, --subsidy-zkey <subsidyZkey>`: The path to the subsidy zkey <br> `-q, --quiet`: Whether to print values to the console <br> `-f, --output <outputDir>`: The output directory for proofs <br> `-tx, --transaction-hash <transactionHash>:` Transaction hash of MACI contract creation <br> `-w, --wasm`: Whether to use the wasm binaries <br> `-pw, --process-wasm <processWasm>`: The path to the process witness generation wasm binary <br> `-tw, --tally-wasm <tallyWasm>`: The path to the tally witness generation wasm binary <br> `-sw, --subsidy-wasm <subsidyWasm>`: The path to the subsidy witness generation wasm binary |
| proveOnChain | Prove the results of a poll on chain | `-o, --poll-id <pollId>`: The poll id <br> `-q, --quiet`: Whether to print values to the console <br> `-x, --contract <contract>`: The MACI contract address <br> `-p, --message-processor-address <messageProcessorAddress>`: The message processor contract address <br> `-t, --tally-contract <tallyContract>`: The tally contract address <br> `-s, --subsidy-contract <subsidyContract>`: The subsidy contract address <br> `-f, --proof-dir <proofDir>`: The proof output directory from the genProofs subcommand |

## Public and private key format

MACI uses private keys in the BabyJub field for operations which occur within
zk-SNARKs, such as decrypting messages or signing commands. As MACI is deployed
on Ethereum, we seek to avoid confusing BabyJub private keys with Ethereum
private keys. To that end, users should pass serialized formats of public and
private keys to this CLI. We use `maci-domainobj`'s `PrivKey.serialize` and
`PubKey.serialize` functions to do so.

Examples of serialized public and private keys:

```
Private key: macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e
Public key:  macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330
```

### Coordinator: Deploy VkRegistry

This command deploys an instance of a VkRegistry contract. Multiple MACI
contracts can refer to the same VkRegistry as long as they are all owned (via
`Ownable.sol`) by the same account.

Example usage:

```bash
ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js deployVkRegistry
```

Example output:

```
VkRegistry: 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
```

### Coordinator: Set verifying keys

Note that the filename of the `.zkey` files must follow this format:

```
ProcessMessages_<STATE_TREE_DEPTH>-<MSG_TREE_DEPTH>-<MSG_SUBTREE_DEPTH>-<VOTE_OPTION_TREE_DEPTH>_test.<CONTRIBUTION_NUM>.zkey
TallyVotes_<STATE_TREE_DEPTH>-<INT_STATE_TREE_DEPTH>-<VOTE_OPTION_TREE_DEPTH>>_test.<CONTRIBUTION_NUM>>.zkey
```

Example usage:

```bash
ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js setVerifyingKeys \
    -s 10 -i 1 -m 2 -v 2 -b 1 \
    -p ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \
    -t ./zkeys/TallyVotes_10-1-2_test.0.zkey \
    -k 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
```

Example output:

```
Generating ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey.vk.json, please wait...
Generating ./zkeys/TallyVotes_10-1-2_test.0.zkey.vk.json, please wait...
Transaction hash: 0x582631c36a4e21e0b65c3f9100c6343408c8683a36ded36fc02a9be07fa079e8
```

### Coordinator: Create MACI instance

Example usage:

```bash
ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js create -r 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
```

Example output:

```
Deploying InitialVoiceCreditProxy
Deploying Poseidon contracts
Linking Poseidon libraries to MACI
Linking Poseidon libraries to PollFactory
Linking Poseidon libraries to MessageAqFactory
Deploying MACI
Transferring PollFactory ownership to MACI
Transferring MessageAqFactory ownership to PollFactory
Initialising MACI
MACI: 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D
```

### Coordinator: Deploy poll

Example usage:

```bash
ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node ./build/index.js deployPoll \
    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \
    -pk macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \
    -t 30 -g 25 -mv 25 -i 1 -m 2 -b 1 -v 2
```

Example output:

```
Verifier: 0x5E70a420373D6BcB1ca3D08FEeB78a2F80727B29
Poll ID: 0
Poll contract: 0x710FA420C3bE4bb0730265d6581BDda11087A901
PollProcessorAndTallyer contract: 0x62C3204a98bbbd73C8fc3B8bfCDa467CB079dF47
```

### User: sign up

Example usage:

```bash
ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node ./build/index.js signup \
    -p macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \
    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D
```

Example output:

```
Transaction hash: 0xcae04f618a0b45896732632121248c312cbc68584519c1e43932b110da9078bc
State index: 1
```

### User: publish message

Example usage:

```bash
ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js publish \
    -p macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \
    -sk macisk.2ae4f199bf3925a2407f7c775c9261f351ab861d8e9ecbb84622bdd3f6d41b08 \
    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \
    -i 1 -v 0 -w 9 -n 1 -o 0
```

### Coordinator: merge state tree

Example usage:

```bash
ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js mergeSignups -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D -o 0
```

### Coordinator: merge message tree

Example usage:

```bash
ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js mergeMessages -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D -o 0
```

### Coordinator: generate Maci state offchain

Example usage to generate the state locally from the smart contracts events:

```bash
node build/index.js genLocalState \
    --poll-id $1 \
    --output localState.json \
    --privkey macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e \
    --num-blocks-per-request 50
```

### Coordinator: generate proofs

Example usage:

```bash
node build/index.js genProofs -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \
    -sk macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e \
    -o 0 \
    -t tally.json \
    -f proofs.json \
    -r ~/rapidsnark/build/prover \
    -wp ./zkeys/ProcessMessages_10-2-1-2_test \
    -wt ./zkeys/TallyVotes_10-1-2_test \
    -zp ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \
    -zt ./zkeys/TallyVotes_10-1-2_test.0.zkey \
```

### Coordinator: generate proofs using a local state file

Example usage to generate the proofs locally from the local state file created with genLocalState:

```bash
 # Intel parameters
node/build.js genProofs \
    --privkey macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e \
    --poll-id $1 \
    --rapidsnark ~/rapidsnark/build/prover \
    --process-witnessgen ./zkeys/ProcessMessages_"$PROCESS_MESSAGES_PARAMS" \
    --tally-witnessgen ./zkeys/TallyVotes_"$TALLY_VOTES_PARAMS" \
    --process-zkey "$ZKEYS_DIR"/ProcessMessages_"$PROCESS_MESSAGES_PARAMS".0.zkey \
    --tally-zkey "$ZKEYS_DIR"/TallyVotes_"$TALLY_VOTES_PARAMS".0.zkey \
    --tally-file tally.json \
    --output proofs/ \
    --state-file localState.json
```

### Coordinator: prove on chain

Example usage:

```bash
node build/index.js proveOnChain \
    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \
    -o 0 \
    -q 0x62C3204a98bbbd73C8fc3B8bfCDa467CB079dF47 \
    -f proofs/
```

### Anyone: verify tally

Example usage:

```bash
node build/index.js verify \
    -x 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    -o 0 \
    -t tally.json \
    -q 0x62C3204a98bbbd73C8fc3B8bfCDa467CB079dF47
```

## Demonstration

### Scenario:

1. Alice votes for Party A
2. Alice changes her key
3. Eve tries to bribe Alice to change her vote to Party B
4. Alice submits an invalid vote for Party B
5. The coordinator processes the votes, computes, and verifies the final tally
6. The expected result is: Party A has some votes and Party B has 0 votes.

Implication: Alice's invalid vote was not counted, and Eve had no way to tell.

### Examples of serialized public and private keys:

```
Coordinator:
Private key: macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e
Public key:  macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330

Alice:
Private key: macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c
Public key:  macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391
```

### Coordinator: Deploy VkRegistry

```bash
node build/index.js deployVkRegistry
```

Output:

```bash
VkRegistry: 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
```

### Coordinator: Set verifying keys

```bash
node build/index.js setVerifyingKeys \
    --vk_registry 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0 \
    --state-tree-depth 10 \
    --int-state-tree-depth 1 \
    --msg-tree-depth 2 \
    --vote-option-tree-depth 2 \
    --msg-batch-depth 1 \
    --process-messages-zkey ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \
    --tally-votes-zkey ./zkeys/TallyVotes_10-1-2_test.0.zkey
```

Output:

```bash
Setting verifying keys...
Transaction hash: 0x16236fe5e124f3d0c33ddf20a37ceba9730a659630258a1e858b3e335e057b8e
```

### Coordinator: Create MACI instance

```bash
node build/index.js create \
    --vk-registry 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
```

Output:

```bash
Deploying InitialVoiceCreditProxy
Deploying Poseidon contracts
Linking Poseidon libraries to MACI
Linking Poseidon libraries to PollFactory
Linking Poseidon libraries to MessageAqFactory
Deploying MACI
Transferring PollFactory ownership to MACI
Transferring MessageAqFactory ownership to PollFactory
Initialising MACI
MACI: 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a
```

### Coordinator: Deploy poll

```bash
node ./build/index.js deployPoll \
    --maci-address 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --pubkey macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \
    --duration 1000 \
    --max-messages 25 \
    --max-vote-options 25 \
    --int-state-tree-depth 1 \
    --msg-tree-depth 2 \
    --msg_batch_depth 1 \
    --vote-option-tree-depth 2
```

Output:

```bash
Verifier: 0x0d8cc4b8d15D4c3eF1d70af0071376fb26B5669b
Poll ID: 0
Poll contract: 0x08e8f54262de52fe7Dfd0Bc0C9Ea87689d70e985
PollProcessorAndTallyer contract: 0xEcFcaB0A285d3380E488A39B4BB21e777f8A4EaC
```

### Alice: sign up

```bash
node ./build/index.js signup \
    --pubkey macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391 \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a
```

Output:

```bash
Transaction hash: 0xcdff1e0cd3021cdc3ba2c65cfd74bac3715c32efdd2052c0e8f3a677a81a758b
State index: 1
```

### Alice: votes for Party A (option index 0)

```bash
node build/index.js publish \
    --pubkey macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391 \
    --privkey macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --state-index 1 \
    --vote-option-index 0 \
    --new-vote-weight 9 \
    --nonce 1 \
    --poll-id 0
```

Output:

```bash
Transaction hash: 0xc0964069834b171bb698ffc61e31e1be456c740ff1967ccad7d8cd8ed362e545
Ephemeral private key: macisk.1bf4bba7086c213606bb4a775b1ceaa4c2e7119c329748e675375f0d79c900dc
```

### Alice: submits an invalid vote for Party B (option index 1) with different public key

```bash
node build/index.js publish \
    --pubkey macipk.d5788ea6ccf1ec295df99aaef859031fe7bd359e7e03acb80eb6e8a192f2ce19 \
    --privkey macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --state-index 1 \
    --vote-option-index 1 \
    --new-vote-weight 9 \
    --nonce 2 \
    --poll-id 0
```

Output:

```bash
Transaction hash: 0xc13b97e23b387d8c160e0f8b1bfb33dc0ff4441fe63a37f0fc3ec84a0cfa0600
Ephemeral private key: macisk.5bc9f217a29c5defad1ca9be3d649add1eca30037589527476e8335b24cf75b
```

Time Travel

```
node build timeTravel -s 1000
```

### Coordinator: merge state tree

```bash
node build/index.js mergeSignups \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --poll-id 0
```

Output:

```bash
Merging state subroots 1 / 1
Executed mergeMaciStateAqSubRoots(); gas used: 723525
Transaction hash: 0x14621b208fdadbf277edf80b393f1a9694099ae9676903e148fa485eecfadd4b

All state subtrees have been merged.
Merging subroots to a main state root...
Executed mergeStateAq(); gas used: 1015876
Transaction hash: 0xf2903b1c3c83b87c551a71f29e07762b464691ca58b0c6849b2f9b8f5783011f
The state tree has been merged.
```

### Coordinator: merge message tree

```bash
node build/index.js mergeMessages \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --poll-id 0
```

Output:

```bash
Merging message subroots 1 / 1
Executed mergeMaciStateAqSubRoots(); gas used: 604387
Transaction hash: 0xe0c0306b80febe1f6947b6ccbefabef38d01abce0b7611f49ce1cc7e20f196a5

All message subtrees have been merged.
Merging subroots to a main message root...
Executed mergeMessageAq(); gas used: 174376
Transaction hash: 0x424581f08d5f8e9f4fd63b083f9446cc2bff3b8e4b67ebc834076d6e9c34ec20
The message tree has been merged.
```

### Coordinator: generate proofs

```bash
node build/index.js genProofs \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --privkey macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e \
    --poll-id 0 \
    --tally-file tally.json \
    --output proofs \
    --rapidsnark ~/rapidsnark/build/prover \
    --process-witnessgen ./zkeys/ProcessMessages_10-2-1-2_test \
    --tally-witnessgen ./zkeys/TallyVotes_10-1-2_test \
    --process-zkey ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \
    --tally-zkey ./zkeys/TallyVotes_10-1-2_test.0.zkey
```

Output:

```bash
fromBlock = 0
Generating proofs of message processing...

Progress: 1 / 1

Generating proofs of vote tallying...

Progress: 1 / 1

OK
```

### Coordinator: prove on chain

```bash
node build/index.js proveOnChain \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --poll-id 0 \
    --ppt 0xEcFcaB0A285d3380E488A39B4BB21e777f8A4EaC \
    --proof-dir proofs/
```

Output:

```bash
Submitting proofs of message processing...
Transaction hash: 0x59388e69899612390ef22de235629e9355e14f888bb330b46511cc06d8f2035d
Progress: 1 / 1
All message processing proofs have been submitted.

Submitting proofs of vote tallying...
Progress: 1 / 1
Transaction hash: 0xc90e3bd0618def86b709c995485271f806c60701a3f4246903498f27346b9f5e
All vote tallying proofs have been submitted.

OK
```

### Anyone: verify

```bash
node build/index.js verify \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --poll-id 0 \
    --tally-file tally.json \
    --ppt 0xEcFcaB0A285d3380E488A39B4BB21e777f8A4EaC
```

Output:

```bash
{
  provider: 'http://localhost:8545',
  maci: '0xf204a4Ef082f5c04bB89F7D5E6568B796096735a',
  pollId: 0,
  newTallyCommitment: '0x29b47e79c10709047ba9788580c2dc8528f003eab42d30670df78a47b121aa6c',
  results: {
    tally: [
      '9', '0', '0', '0', '0', '0',
      '0', '0', '0', '0', '0', '0',
      '0', '0', '0', '0', '0', '0',
      '0', '0', '0', '0', '0', '0',
      '0'
    ],
    salt: '0x132065c8ad3968008aeb7c114a04de228fa5b3618743ad00f64ad3f773a2e4d2'
  },
  totalSpentVoiceCredits: {
    spent: '81',
    salt: '0x2940f93e085350a04f6ff85e1ebffbc391fc3498f1cb41ab47f8899dc9c6efc6'
  },
  perVOSpentVoiceCredits: {
    tally: [
      '81', '0', '0', '0', '0', '0',
      '0',  '0', '0', '0', '0', '0',
      '0',  '0', '0', '0', '0', '0',
      '0',  '0', '0', '0', '0', '0',
      '0'
    ],
    salt: '0x2db5c3d6b015f8e2ea1cf7ffed7a44af0db8a8c09a5077415c076b6ebcee0571'
  }
}
OK
```
